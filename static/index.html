<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="./js/three.js"></script>
    <script type="text/javascript" src="./js/Tween.js"></script>
    <script type="text/javascript" src="./js/RequestAnimationFrame.js"></script>
    <script type="text/javascript">
        var scene = null;
        var camera = null;
        var renderer = null;

        var mesh = null;
        var id = null;
        var glist = [];
        var count = 0;
        function init() {
            renderer = new THREE.WebGLRenderer({
                canvas: document.getElementById('mainCanvas')
            });
            renderer.setClearColor(0x000000);
            scene = new THREE.Scene();

            // camera
            camera = new THREE.OrthographicCamera(-5, 5, 3.75, -3.75, 0.1, 100);
            camera.position.set(10, 20, 30);
            camera.lookAt(new THREE.Vector3(0, 0, 0));
            scene.add(camera);


            for (var ii = 0; ii < 5000; ii++) {
                var geom = new THREE.Geometry();
                var material = new THREE.PointsMaterial({
                    color: 0x00FFFF,
                    size: 0.2
                });
                // 创建单个粒子
                var geom = new THREE.Geometry();
                var color1 = new THREE.Color(0x0000ff);
                //var p1 = new THREE.Vector3(Math.random() * 30, Math.random() * 40, Math.random() * 10);
                var p1 = new THREE.Vector3(0, 0, 0);
                // 将粒子加入粒子geometry
                geom.vertices.push(p1);
                geom.colors.push(color1);
                // 创建粒子系统
                var system = new THREE.Points(geom, material);
                system.position.x = Math.random() * 30;
                system.position.y = Math.random() * 40;
                system.position.z = Math.random() * 10;

                // 将粒子系统加入场景
                scene.add(system);
                glist.push(system);

            }
            var loader = new THREE.JSONLoader();
            loader.load('obj/cpac5.json', function (geometry) {
                var material = new THREE.PointsMaterial({size: 0.1, color: 0xffffff});
                var object = new THREE.Points(geometry, material);


                for (var ii = 0; ii < glist.length; ii++) {
                    var findpos = geometry.vertices[ii % geometry.vertices.length];
                    var tween = new TWEEN.Tween(glist[ii].position).to({
                        x: findpos.x,
                        y: findpos.y,
                        z: findpos.z
                    }, 4000).delay(Math.random() * 1000).easing(TWEEN.Easing.Exponential.In).start();

                }


            });
            animate();


        }
        function update() {
            console.log('test');

        }
        function animate() {
            requestAnimationFrame(animate);
            TWEEN.update();

            renderer.render(scene, camera);
        }
        function next() {
            var loader = new THREE.JSONLoader();
            var res;
            var objlist = ['cpac5.json', 'cpkv3.json', 'cpgame3.json', 'cpbook2.json', 'cpmovie4.json', 'qr.json'];
            count += 1;
            res = 'obj/' + objlist[(count) % objlist.length];


            loader.load(res, function (geometry) {
                var material = new THREE.PointsMaterial({size: 0.1, color: 0xffffff});
                var object = new THREE.Points(geometry, material);

                for (var ii = 0; ii < glist.length; ii++) {
                    var findpos = geometry.vertices[ii % geometry.vertices.length];
                    var tween = new TWEEN.Tween(glist[ii].position).to({
                        x: findpos.x,
                        y: findpos.y,
                        z: findpos.z
                    }, 3000).delay(Math.random() * 1000).easing(TWEEN.Easing.Exponential.In).start();

                }


            });
            animate();


        }

    </script>
</head>
<body onload="init()">
<canvas id="mainCanvas" width="800px" height="600px"></canvas>
<button onclick="next()">next</button>
</body>
</html>
